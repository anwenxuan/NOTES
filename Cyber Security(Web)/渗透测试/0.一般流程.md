# 一、明确目标

### 1、交互阶段-明确目标

确定项目范围，项目范围圈出了要测试的内容。只能对已授权的资产进行测试，未授权的资产不能进行任何测试。

1）确定范围：测试的范围，如：IP、域名、内外网、整站or部分模块

2）确定规则：能渗透到什么程度（发现漏洞为止or继续利用漏洞）、时间限制、能否修改上传、能否提权...

目标系统介绍、重点保护对象及特性。

是否允许数据破坏？

是否允许阻断业务正常运行？

测试之前是否应当知会相关部门接口人？

接入方式？外网和内网？

测试是发现问题就算成功，还是尽可能的发现多的问题？

渗透过程是否需要考虑社会工程？

3）确定需求：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？

根据需求和自己技术能力来确定能不能做、能做多少



信息收集

漏洞探测 ==>漏洞利用 exp

漏洞验证 poc

编写报告

信息整理

获取所需

信息分析

### 2.分析风险，获得授权

分析渗透测试过程中可能产生的风险，如大量测试数据的处理、影响正常业务开展、服务器发生异常的应急、数据备份和恢复、测试人力物力成本...

由测试方书写实施方案初稿并提交给客户（or本公司内部领导）进行审核。在审核完成后，从客户（or本公司内部领导）获取对测试方进行书面委托授权书，授权测试方进行渗透测试。



# 二、信息搜集

尽量多的收集关于目标web应用的各种信息，比如：脚本语言的类型、服务器的类型、目录的结构、使用的开源软件、数据库类型、所有链接页面，用到的框架等

被动信息搜集：指通过公开渠道的可获得信息，**与目标系统或者主机不产生直接的信息交互**，以尽可能避免留下任何痕迹的信息收集方法。

主动信息收集：主动信息搜集是利用一些工具和手段，与搜集的目标发生一些交互，从而获得目标信息的一种行为。

### 1. 主动扫描：开放搜索

开放搜索：利用搜索引擎获得后台、未授权页面、敏感url

基础信息：IP，网段，域名，端口

系统信息：操作系统版本

应用信息：各端口的应用，例如web应用，邮件应用等

版本信息：所有探测到的版本

服务信息：服务器类型、版本

人员信息：域名注册人员信息，web应用中网站发帖人的id，管理员姓名等

防护信息：试着看能否探测到防护设备



# 三、威胁建模

利用获取到的信息来标识目标组织可能存在的漏洞与缺陷。威胁建模有两个关键要素：资产分析和威胁分析。识别主要和次要资产并对其进行分类，并根据资产识别其可能存在的威胁。比如看到28017端口我们要想到是否存在mongodb未授权访问，看到21端口我们要想到是否存在ftp匿名登录等等。

攻击规划；根据威胁模型确定下一步需要搜集的信息和攻击方法。威胁模型建立后，可行的攻击矢量已基本确定，接下来要做的就是一个一个验证其是否可行，在这个过程中依然会伴随着信息的收集以及威胁模型的调整。

- 方法：

1）漏扫：AWVS、AppScan...

2）结合漏洞去exploit-db等位置找利用

3）在网上寻找验证POC

- 内容：

系统漏洞：系统没有及时打补丁

Websever漏洞：Websever配置问题

Web应用漏洞：Web应用开发问题

其它端口服务漏洞：各种21/8080(st2)/7001/22/3389

通信安全：明文传输，token在cookie中传送等



# 四、漏洞分析-验证

漏洞分析是一个发现系统和应用程序中的漏洞的过程

- 验证

自动化验证：结合自动化扫描工具提供的结果

手工验证：根据公开资源进行验证

试验验证：自己搭建模拟环境进行验证

登录猜解：有时可以尝试猜解一下登陆口的账号密码等信息

业务漏洞验证：如发现业务漏洞，要进行验证

公开资源的利用

exploit-db/wooyun/

渗透代码网站

通用、缺省口令

厂商的漏洞警告等

为下一步实施渗透做准备

精准攻击：准备好上一步探测到的漏洞exp（漏洞利用），用来精准攻击

绕过防御机制：是否有防火墙等设备，如何绕过

定制攻击路径：最佳工具路径，根据薄弱入口，高内网权限位置，最终目标

绕过检测机制：是否有检测机制，流量监控，杀毒软件，恶意代码检测等（免杀）

攻击代码：经过试验得来的代码，包括不限于xss代码，sql注入语句等



# 五、漏洞攻击

很多情况下，互联网上有很多公开的漏洞利用，可直接拿来使用，但对于一些特殊情况，则需要我们根据实际情况来量身定制有效载荷(payload)和漏洞利用(exploit)。

实施攻击：根据前几步的结果，进行攻击

获取内部信息：基础设施（网络连接，vpn，路由，拓扑等）

进一步渗透：内网入侵，敏感目标

持续性存在：一般对客户做渗透不需要。rookit，后门，添加管理账号，驻扎手法等

清理痕迹：清理相关日志（访问，操作），上传文件等

整理渗透工具：整理渗透过程中用到的代码，poc，exp等

整理收集信息：整理渗透过程中收集到的一切信息

整理漏洞信息：整理渗透过程中遇到的各种漏洞，各种脆弱位置信息

目的：为了最后形成报告，形成测试结果使用。



# 六、后渗透阶段

拿到系统权限后的后续操作。

后渗透攻击阶段的操作，可分为两种：权限维持和内网渗透。

- 权限维持：继续寻找并利用漏洞进行提权。同时为了保持对系统的访问权限，我们应该留下后门（木马文件等）并隐藏自己（清除日志、隐藏文件等）。
- 内网渗透：利用获取到的服务器对其所在的内网环境进行渗透。内网环境往往要比外网环境有趣，我们可以利用获取到的服务器进一步获取目标组织的敏感信息。

# 七、报告





































































