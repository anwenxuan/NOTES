# 零、指纹识别

## 1、指纹信息

服务器类型：服务器平台、版本等

网站容器：搭建网站的服务组件，例如:iis、Apache、nginx、tomcat等

脚本类型：ASP、PHP、JSP、aspx等

CMS (内容管理系统) 信息



其他Python 脚本工具(供学习) ：Whatweb、httprint、Bugscanner、wappalyzer

通过识别目标网站所使用的操作系统、CMS、服务器与中间件信息，可以帮助我们进一步了解渗透测试环境，可以利用已知的一些CMS漏洞或中间件漏洞来进行攻击。

## 2、指纹搜集思路

1.指定路径下指定名称的js文件或代码。

2.指定路径下指定名称的css文件或代码。

3.<title>中的内容，有些程序标题中会带有程序标识，但不是很多。

4.meta标记中带程序标识<meta name="description"/><meta name="keywords"/><meta name="generator"/><meta name="author"/><meta name="copyright"/>

5.display:none中的版权信息。

6.页面底部版权信息，关键字© Powered by等。

7.readme.txt、License.txt、help.txt等文件。

8.指定路径下指定图片文件，如一些小的图标文件，后台登录页面中的图标文件

等，一般管理员不会修改它们。

9.注释掉的html代码中<!–

10.http头的X-Powered-By中的值，有的应用程序框架会在此值输出。

11.cookie中的关键字

12.robots.txt文件中的关键字

robots.txt 中禁止的路径很可能说明站点就有这些路径 而且robots.txt 多是可访问的

13.404页面

14.302返回时的旗标

## 3、工具

CMS识别工具：在线工具 http://whatweb.bugscaner.com/look/ 、云悉指纹、御剑

## 4、利用思路

查询指定CMS的漏洞：[https://bugs.shuimugan.com](https://bugs.shuimugan.com/)



# 一、端口信息

## 1、端口

65535个 即: (2^16)

例如计算机中的80端口、21端口、23端口等。

21>>FTP

22 >>SSH

23 >Telnet

110 >> POP3

1433 >>Sqlsever

3306 >> Mysql

3389 >>Mstsc

8080 >>Tomcatjboss

9090 >>WebSphere等

在计算机中每-个端口代表个服务。

在Windows命令行中使用netstat -ano显示开放端口。linux中用 [leof](!https://www.runoob.com/w3cnote/linux-check-port-usage.html) 



## 2、探测工具

masscan

nmap

在线探测： http://tool.chinaz.com/port

## 3、针对远程连接服务端口(针对不同的端口不同的攻击方式)

对于扫描到的端口可以在搜索引擎中查找对应的攻击方法进行测试。

| 端口 | 端口说明            | 攻击方式                              |
| ---- | ------------------- | ------------------------------------- |
| 22   | SSH 远程连接        | 嗅探、SSH隧道及内网代理转发、文件传输 |
| 23   | Telnet 远程连接     | 嗅探、爆破、弱口令                    |
| 3306 | 数据库端口          |                                       |
| 3389 | rdp 远程连接        | Shift后门，爆破                       |
| 5900 | VNC 远程连接        | 弱口令、RCE                           |
| 5632 | PcAnywhere 远程连接 | 嗅探、代码执行                        |

## 4、防御措施

a、关闭不必要的端口;

b、对重要业务的服务端口设置防火墙;

c、加强员工信息安全意识，经常性更换用户密码;

d、经常更新软件，打补丁(patch)



# 二、敏感目录

## 1、收集方向

robots.txt、后台目录、安装包、上传目录、mysql管理接口、安装页面

phpinfo、编辑器、iis短文件

## 2、常用工具

针对目标Web目录结构和敏感隐藏文件探测是非常重要的。在探测过程中很有可能会探测出后台页面、上传页面、数据库文件、甚至是网站源代码文件压缩包等。

字典爆破 >> 御剑、dirbuster、wwwscan、IlS_shortname_Scanner

蜘蛛爬行 >> 爬行菜刀、webrobot、burp等

dirb命令行工具、



# 三、子域名

## 1、子域名收集的作用

扩大渗透测试范围

找到目标站点突破口

业务边界安全

回归初心“信息收集”

## 2、什么是子域名

子域名（或子域;英语：Subdomain）是在域名系统等级中，属于更高一层域的域。比如，[mail.example.com ](http://mail.example.com/) (mail为三级域名)和[calendar.example.com](http://calendar.example.com/)是  [example.com ](http://example.com/) (example为二级域名)的两个子域，而[example.com](http://example.com/)则是顶级域.com的子域。

## 3、工具

爆破，搜索引擎收集，dns查询，证书查询

a.子域名挖掘工具如: MaltegoCE、wydomain、subDomainsBrute、 dnsmaper、 Layer子 域名挖掘机

b.搜索引擎挖掘如:在Google中 输入site:sina.com

c.第三方网站查询: [http://tool.chinaz](http://tool.chinaz/). com/subdomain(有访问比例)、https://dnsdumpster.com/

d.证书透明度公开日志枚举: https://rt.sh/ 、http://censys.io/(ip、站点地址)

e.其他途径: https://phpinfo.me/domain(子域名爆破) 、http:///s .[aizhan.com](http://aizhan.com/)(比较综合)

## 4、问题

**子域名打开就是404页面、403页面怎么做**

尝试使用谷歌语法查找该站点时候存在可访问的页面，或者查看源代码中是否还存在一些信息泄露之类的，不要一看到403、404就直接忽略。



## 5、我国域名情况

我国在国际互联网络信息中心正式注册并运行的顶级域名是.cn，这也是我国的级域名。在顶级域名之下，我国的二级域名又分为类别域名和行政区域名两类。类别域名共6个，包括

用于科研机构的.ac;

用于工商金融企业的.com;

用于教育机构的.edu;用于政府部门的.gov;

用于互联网络信息中心和运行中心的.net;

用于非盈利组织的.org。

而行政区域名有34个，分别对应于我国各省、自治区和直辖市。



# 四、旁站C段

## 1、什么是旁站c段

旁站:同服务器其他站点、旁站是和目标网站在同—台服务器上的其它的网站。

C段:同一网段其他服务器，C段是和目标服务器ip处在同—个C段的其它服务器。

## 2、常用工具

https://www.webscan.cc/

web >> k8旁站、御剑1.5

端口 >> portscan



# 五、真实IP获取

现在大多数的网站都开启了CDN加速，导致我们获取到的IP地址不一定是真实的IP地址。

## 1、什么是CDN

CDN的全称是Content Delivery Network，即内容分发网络。其基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度。

## 2、获取真实IP

a、多地Ping法：由CDN的原理，不同的地方去Ping服务器，如果IP不一样，则目标网站肯定使用了CDN。

- https://asm.ca.com/en/ping.php
- http://ping.chinaz.com/

b、二级域名法：目标站点一般不会把所有的二级域名放cdn上。通过在线工具如站长帮手，收集子域名，确定了没使用CDN的二级域名后。本地将目标域名绑定到同IP（修改host文件），如果能访问就说明目标站与此二级域名在同一个服务器上；如果两者不在同一服务器也可能在同C段，扫描C段所有开80端口的IP，然后挨个尝试。

c、nslookup法：找国外的比较偏僻的DNS解析服务器进行DNS查询，因为大部分CDN提供商只针对国内市场，而对国外市场几乎是不做CDN，所以有很大的几率会直接解析到真实IP。

## 3、绕过CDN

a、内部邮箱源收集到内部邮箱服务器IP地址

b、网站phpinfo文件phpinfo.php

c、分站IP地址，查询子域名，CDN很贵， 很有可再能分站就不使用CDN。

d、国外访问https://asm.ca.com/en/ping.php

e、查询域名解析记录https://viewdns.info/



# 六、敏感信息

## 1、github信息泄露

Github之邮件配置信息泄露: site:[Github.com](http://github.com/) smtp、site:[Github.com](http://github.com/) smtp:@[qq.com](http://qq.com/)

Github之数据库信息泄露: site:[Github.com](http://github.com/) sa password、site:[Github.com](http://github.com/) root password、site:[Github.com](http://github.com/) User ID=’sa’;Password

Github之svn信息泄露: site:[Github.com](http://github.com/) svn、site:Github .com svn username

Github之综合信息泄露: site:[Github.com](http://github.com/) password、site:[Github.com](http://github.com/) ftp ftppassword、

site:[Github.com](http://github.com/)密码、site:[Github.com](http://github.com/) 内部



## 2、WAF信息

WAF识别大多基于Headers头信息，还可以使用Wafw00f，Sqlmap的waf脚本，Nmap的http-waf-detect和http-waf-fingerprint脚本等等。



# 七、Banner信息收集

## 1、什么是Banner

Banner信息，欢迎语，在banner信息中可以得到软件开发商，软件名称、版本、服务类型等信息，通过这些信息可以使用某些工具直接去使用相对应的exp去攻击。

前提条件：需要和目标建立链接，只有建立了链接，我们才能获取对应的banner信息

目标服务器上可以对banner进行隐藏或者禁止读取



## 2、收集方法：

- 使用NC（netcat，瑞士军刀）

  nc -nv 192.168.1.1 21

  -n 表示以数字形式显示IP

  -v 显示详细信息

- 使用dmitry（扫描服务器的一种软件，基于全链接的扫描方式）

  dmitry -pb 192.168.1.1

- 使用namp
- Wappalyzer，



# 八、空间测绘

## 1、shodan https://www.shodan.io/

- Shodan搜索Webcam(摄像头)

  在搜索框中输入Webcam

* Shodan搜索指定IP地址

  通过关键字host指定具体IP地址。例如: host:61.135. 169.121指定探测IP地址主机信息。

- Shodan搜索指定端口

  通过关键字port指定具体端口号。例如:port:22指定搜索22号端口的主机信息。

- Shodan搜索具体城市

  利用city:城市名指定搜索具体城市的内容。例如: city:hangzhou port:22

- Shodan命令行

  a、安装：easy_install shodan

  b、初始化：初始化Shodan就是给Shodan初始化API Key。API Key在官网上方位置 shodan init APIKey

  c、启动与查找：输入shodan显示操作目录(- help)

  ```shell
  shodan count apache/tomcat(查询服务数量)
  ```

  d、命令行搜索： shodan search microsoft iis 6.0 开放iis6.0的服务器ip与端口

  ```shell
  shodan search tomcat
  ```

  e、Shodan获取指定IP地址信息：shodan host IP(存在的漏洞、开放的端口......)

  f、Shodan获取账号信息：shodan info

  g、Shodan获取自身外部IP地址：shodan myip

  h、Shodan检测是否有蜜罐：shodan honeyscore

- python-shodan使用介绍 具体在**https://developer.shodan.io/api**查看

  <img src="image-20211206111651270.png" alt="image-20211206111651270" style="zoom: 33%;" />

## 2、ZoomEye 钟馗之眼 https://www.zoomeye.org/

是一款针对网络空间的搜索引擎，收录了互联网空间中的设备、网站及其使用的服务或组件等信息。

**搜索语法**

1、app:nginx　　组件名

2、ver:1.0　　版本

3、os:windows　　操作系统

4、country:”China”　　国家

5、city:”hangzhou”　　城市

6、port:80　　端口

7、hostname:google　　主机名

8、site:thief.one　　网站域名

9、desc:nmask　　描述

10、keywords:nmask’blog　　关键词

11、service:ftp　　服务类型

12、ip:8.8.8.8　　ip地址

13、cidr:8.8.8.8/24　　ip地址段

## 3、whois

#### whois

whois信息可以获取关键注册人的信息，包括注册商、联系人、联系邮箱、联系电话、创建时间等,可以进行邮箱反查域名，爆破邮箱，社工，域名劫持，寻找旁站等等。

是用来查询域名的IP以及所有者等信息的传输协议。简单说，whois就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库(如域名所有人、域名注册商)

不同域名后缀的whois信息需要到不同的whois数据库查询。如.com的whois数据库和.edu的就不同。每个域名或IP的WHOIS信息由对应的管理机构保存，例如，以.com结 尾的域名的WHOIS信息由.com域名运营商VeriSign管理，中国国家顶级域名.cn域名由CNNIC(中国互联网络信息中心)管理

WHOIS协议。其基本内容是，先向服务器的TCP端口43建立一个连接，发送查询关键字并加上回车换行，然后接收服务器的查询结果。

通过Whois查询可以获得域名注册者邮箱地址等信息。一般情况下对于中小型网域名注册者就是网站管理

#### Whois查询方法

Web接口查询: [whois.aliyun.com/](http://aliyun.com/) 、https: / /www. whois365. com/cn/

http://[whois.chinaz.com/](http://whois.chinaz.com/)、https://whois.aizhan.com/



# 九、Google Hack

http://www.360doc.com/content/17/0522/17/41741363_656204810.shtml



# 十、常用漏洞查询方式

1目录遍历漏洞 语法为: site:xxx intitle:index.of

2 配置文件泄露 语法为: site:xxx ext:xml | ext:conf | ext:cnf | ext:reg | ext:inf | ext:rdp | ext:cfg | ext:txt | extra | ext:ini

3数据库文件泄露 site:xxx ext:sql | ext:dbf | ext:mdb

4日志文件泄露 site:xxx ext:log

5备份和历史文件 site:xxx ext:bkf | ext:bkp | ext:bak | extld | ext:backup

6SQL错误 site:xxx intext:"sql syntax near" | intext:"syntax error has occurred" | intext:"incorrect syntax near" | intext:"unexpected end of SQL command" | intext:"Warning: mysql_connect()" | intext:"Warning: mysql_query()" | intext:"Warning: pg_connect()"

7公开文件信息 site:xxx ext:doc | ext:docx | extdt | ext:pdf | ext:rtf | ext:sxw | ext:psw | ext:ppt | ext:pptx | ext:pps | ext:csv

8 phpinfo() site:xxx ext:php intitle:phpinfo "published by the PHP Group"
